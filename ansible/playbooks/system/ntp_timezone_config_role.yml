---
# NTP and Timezone Configuration Playbook (Using Community Role)
# Uses linux-system-roles.timesync for time synchronization
- name: Configure NTP Time Synchronization and Timezone
  hosts: all
  become: true
  gather_facts: true

  vars:
    # linux-system-roles.timesync variables
    timesync_ntp_servers:
      - hostname: "{{ ntp_servers[0] | default('0.pool.ntp.org') }}"
        iburst: true
      - hostname: "{{ ntp_servers[1] | default('1.pool.ntp.org') }}"
        iburst: true
      - hostname: "{{ ntp_servers[2] | default('2.pool.ntp.org') }}"
        iburst: true
      - hostname: "{{ ntp_servers[3] | default('3.pool.ntp.org') }}"
        iburst: true

  pre_tasks:
    - name: Apply common configuration
      ansible.builtin.include_role:
        name: common

    - name: Set timezone
      community.general.timezone:
        name: "{{ timezone | default('UTC') }}"

  roles:
    - role: linux-system-roles.timesync

  post_tasks:
    - name: Display final time status
      ansible.builtin.command: timedatectl status
      register: time_after
      changed_when: false

    - name: Show final time synchronization status
      ansible.builtin.debug:
        msg: |
          === FINAL TIME CONFIGURATION ===
          {{ time_after.stdout }}
