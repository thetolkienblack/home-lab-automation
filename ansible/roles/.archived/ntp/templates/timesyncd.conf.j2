# ===========================================
# templates/system/ntp/timesyncd.conf.j2
# systemd-timesyncd configuration for Debian 13
# ===========================================

# systemd-timesyncd configuration
# Managed by Ansible - {{ ansible_managed }}
# Generated on: {{ ansible_date_time.iso8601 }}

[Time]
# NTP servers configuration
{% if ntp_servers is defined and ntp_servers | length > 0 %}
NTP={{ ntp_servers | join(' ') }}
{% else %}
NTP=pool.ntp.org time.google.com
{% endif %}

{% if ntp_pool_servers is defined and ntp_pool_servers | length > 0 %}
# Pool servers
FallbackNTP={{ ntp_pool_servers | join(' ') }}
{% endif %}

# Root distance maximum (seconds)
RootDistanceMaxSec={{ ntp_root_distance_max | default(5) }}

# Poll intervals (seconds)
PollIntervalMinSec={{ ntp_poll_interval_min | default(32) }}
PollIntervalMaxSec={{ ntp_poll_interval_max | default(2048) }}

# Connection retry interval (seconds)
ConnectionRetrySec={{ ntp_connection_retry | default(30) }}

# Save clock to disk interval (seconds)
SaveIntervalSec={{ ntp_save_interval | default(60) }}

{% if ntp_require_dnssec | default(false) %}
# Use only DNSSEC-validated time sources
# RequireDNSSEC=true
{% endif %}

{% if ntp_ipv4_only | default(false) %}
# Restrict to IPv4 only
# IPv4Only=true
{% endif %}