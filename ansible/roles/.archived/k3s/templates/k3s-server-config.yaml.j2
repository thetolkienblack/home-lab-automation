# k3s Server Configuration
{% if k3s_cni == 'calico' %}
# Disable default CNI (Flannel) for Calico
flannel-backend: none
disable-network-policy: true
{% endif %}

# Cluster CIDR configuration
cluster-cidr: {{ k3s_cluster_cidr }}
service-cidr: {{ k3s_service_cidr }}

# Disable default components
{% for component in k3s_disable_components %}
disable: {{ component }}
{% endfor %}

# Server configuration
tls-san:
  - {{ k3s_server_host }}
{% if ansible_hostname != k3s_server_host %}
  - {{ ansible_hostname }}
{% endif %}
{% if ansible_fqdn is defined and ansible_fqdn != k3s_server_host %}
  - {{ ansible_fqdn }}
{% endif %}

# Write kubeconfig with correct permissions
write-kubeconfig-mode: "0644"

# Additional server arguments
{% for arg in k3s_server_extra_args %}
{{ arg }}
{% endfor %}
